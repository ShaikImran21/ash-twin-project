Generate a single-file, production-ready index.html that implements a browser-based Street View treasure hunt game   â”‚
â”‚ with a Trail Mode feature. Include ALL HTML, CSS, and JavaScript inline in this one fileâ€”no external build tools or  â”‚
â”‚ frameworks. The app must run as a static file served by a local server.                                              â”‚
â”‚                                                                                                                      â”‚
â”‚ High-level goal:                                                                                                     â”‚
â”‚                                                                                                                      â”‚
â”‚  â€¢ Fullscreen Google Street View interface for navigating to real-world targets from a provided dataset.             â”‚
â”‚  â€¢ â€œINITIATE SEQUENCEâ€ selects a random target (from provided data) and initializes Street View near it.             â”‚
â”‚  â€¢ â€œğŸ¬ TRAIL MODEâ€ plans a walking route and automatically moves through Street View along that route to the target. â”‚
â”‚  â€¢ Consistent use of target coordinates under STATE.activeLoot.coords.lat and STATE.activeLoot.coords.lng (never     â”‚
â”‚    STATE.activeLoot.target).                                                                                         â”‚
â”‚                                                                                                                      â”‚
â”‚ Important:                                                                                                           â”‚
â”‚                                                                                                                      â”‚
â”‚  â€¢ Place a clear TODO comment at the top showing where to insert the Google Maps API key in the script tag.          â”‚
â”‚  â€¢ The file must work if opened via http://localhost:8000/index.html with a valid Maps JS API key.                   â”‚
â”‚                                                                                                                      â”‚
â”‚ Project context:                                                                                                     â”‚
â”‚                                                                                                                      â”‚
â”‚                                                                                                                      â”‚
â”‚                                                                                                                      â”‚
â”‚  â€¢ An accompanying file verse_data_enhanced.js may exist which exports HUNT_LOCATIONS_WITH_PATHS, an array of        â”‚
â”‚    objects like: [ { name: "Location Name", coords: { lat: 35.0000, lng: 139.0000 }, year: "1234 AD", history: "One  â”‚
â”‚    or two sentences...", clue: "A short clue hint...", verse: "A poetic or narrative verse..." }, ... ]              â”‚
â”‚  â€¢ If verse_data_enhanced.js is present, load it via a  tag. If it is missing, include a small fallback dataset      â”‚
â”‚    inside index.html to avoid runtime errors.                                                                        â”‚
â”‚  â€¢ There are audio assets in an assets/ folder:                                                                      â”‚
â”‚     â€¢ assets/boom.wav (error or bad action)                                                                          â”‚
â”‚     â€¢ assets/collect.wav (success)                                                                                   â”‚
â”‚     â€¢ assets/warp.wav (a jump during trail movement)                                                                 â”‚
â”‚                                                                                                                      â”‚
â”‚ Strict requirements:                                                                                                 â”‚
â”‚                                                                                                                      â”‚
â”‚  â€¢ No external CSS or JS frameworks (no Bootstrap, jQuery, etc.).                                                    â”‚
â”‚  â€¢ The file must be self-contained and readable with inline CSS and JS.                                              â”‚
â”‚  â€¢ Must use vanilla JavaScript and Google Maps JavaScript API v3.                                                    â”‚
â”‚  â€¢ Include google.maps.geometry library for polyline decoding. Set libraries=geometry in the script.                 â”‚
â”‚                                                                                                                      â”‚
â”‚ Google API setup:                                                                                                    â”‚
â”‚                                                                                                                      â”‚
â”‚  â€¢ Load Google Maps JavaScript API using a script tag like:                                                          â”‚
â”‚  â€¢ Add a comment near the script tag: â€œTODO: Insert your Google Maps API keyâ€                                        â”‚
â”‚  â€¢ Use:                                                                                                              â”‚
â”‚     â€¢ google.maps.StreetViewPanorama                                                                                 â”‚
â”‚     â€¢ google.maps.DirectionsService                                                                                  â”‚
â”‚     â€¢ google.maps.StreetViewService                                                                                  â”‚
â”‚     â€¢ google.maps.Map (as a minimap)                                                                                 â”‚
â”‚     â€¢ google.maps.geometry.encoding.decodePath for polyline decoding                                                 â”‚
â”‚                                                                                                                      â”‚
â”‚ HTML structure (IDs and classes must match exactly):                                                                 â”‚
â”‚                                                                                                                      â”‚
â”‚  â€¢ A fullscreen container:                                                                                           â”‚
â”‚                                                                                                                      â”‚
â”‚ CSS requirements:                                                                                                    â”‚
â”‚                                                                                                                      â”‚
â”‚  â€¢ Make #streetview fill the viewport beneath the toolbar.                                                           â”‚
â”‚  â€¢ Position #toolbar at the top; horizontal layout. Sticky/fixed to the top, with a slight shadow.                   â”‚
â”‚  â€¢ #btn-trail should visually indicate on/off state:                                                                 â”‚
â”‚     â€¢ Default: gold background (#d4af37) with subtle hover brighter.                                                 â”‚
â”‚     â€¢ Active: stronger glow or darker gold with an â€œACTIVEâ€ state look.                                              â”‚
â”‚  â€¢ #minimap: small map overlay (200x200px), positioned bottom-left with a light border and shadow.                   â”‚
â”‚  â€¢ #verse-bar: bottom overlay spanning width, semi-transparent dark background with white text, slight padding.      â”‚
â”‚  â€¢ #spinner: centered overlay; large text or simple CSS spinner acceptable.                                          â”‚
â”‚  â€¢ #toast: top-right or bottom-right small notification area; show/hide with fade.                                   â”‚
â”‚  â€¢ Ensure responsive behavior on mobile widths.                                                                      â”‚
â”‚                                                                                                                      â”‚
â”‚ JavaScript: Global STATE object (exact shape): const STATE = { streetView: null,           //                        â”‚
â”‚ google.maps.StreetViewPanorama map: null,                  // google.maps.Map (minimap) directionsService: null,     â”‚
â”‚ // google.maps.DirectionsService streetViewService: null,    // google.maps.StreetViewService currentPos: { lat:     â”‚
â”‚ null, lng: null }, // last known panorama position activeLoot: null,           // selected item from                 â”‚
â”‚ HUNT_LOCATIONS_WITH_PATHS trailModeActive: false,     // whether trail mode is on routePolyline: null,        //     â”‚
â”‚ google.maps.Polyline for route visualization waypoints: [],              // Array<{ lat: number, lng: number }>      â”‚
â”‚ waypointIndex: 0,           // current waypoint index while moving advanceTimer: null,         // timer/interval ID  â”‚
â”‚ for movement loop markers: {                  // minimap markers me: null,                 // current position       â”‚
â”‚ marker target: null              // destination marker } };                                                          â”‚
â”‚                                                                                                                      â”‚
â”‚ Initialization:                                                                                                      â”‚
â”‚                                                                                                                      â”‚
â”‚  â€¢ On DOMContentLoaded:                                                                                              â”‚
â”‚     â€¢ Bind click handlers:                                                                                           â”‚
â”‚        â€¢ #btn-init -> startLevel()                                                                                   â”‚
â”‚        â€¢ #btn-trail -> toggleTrailMode()                                                                             â”‚
â”‚     â€¢ Initialize Maps constructs when API is ready:                                                                  â”‚
â”‚        â€¢ STATE.directionsService = new google.maps.DirectionsService();                                              â”‚
â”‚        â€¢ STATE.streetViewService = new google.maps.StreetViewService();                                              â”‚
â”‚        â€¢ STATE.map = new google.maps.Map(document.getElementById('minimap'), { mapTypeId: 'roadmap', zoom: 15,       â”‚
â”‚          center: { lat: 0, lng: 0 }, disableDefaultUI: true });                                                      â”‚
â”‚     â€¢ Create STATE.streetView = new google.maps.StreetViewPanorama(document.getElementById('streetview'), {          â”‚
â”‚       position: { lat: 0, lng: 0 }, pov: { heading: 0, pitch: 0 }, zoom: 1, visible: true });                        â”‚
â”‚                                                                                                                      â”‚
â”‚ Data loading:                                                                                                        â”‚
â”‚                                                                                                                      â”‚
â”‚  â€¢ Try to read global HUNT_LOCATIONS_WITH_PATHS if loaded from verse_data_enhanced.js.                               â”‚
â”‚  â€¢ If not present, define a fallback array with at least 2-3 sample locations in the same schema so the app runs.    â”‚
â”‚                                                                                                                      â”‚
â”‚ Helper utilities to implement (exact function names and behavior):                                                   â”‚
â”‚                                                                                                                      â”‚
â”‚  â€¢ clamp(val, min, max)                                                                                              â”‚
â”‚  â€¢ haversineDistance(lat1, lng1, lat2, lng2) // returns meters                                                       â”‚
â”‚  â€¢ showToast(message, timeoutMs=2500)                                                                                â”‚
â”‚  â€¢ setLoading(loading) // toggles #spinner hidden attribute                                                          â”‚
â”‚  â€¢ playSound(name) // name âˆˆ { 'boom', 'collect', 'warp' } -> plays assets/*.wav with error handling                 â”‚
â”‚  â€¢ setUIEnabled(enabled) // enables/disables #btn-trail based on readiness                                           â”‚
â”‚                                                                                                                      â”‚
â”‚ Core functions (exact signatures):                                                                                   â”‚
â”‚                                                                                                                      â”‚
â”‚  â€¢ startLevel():                                                                                                     â”‚
â”‚     â€¢ Randomly choose STATE.activeLoot from HUNT_LOCATIONS_WITH_PATHS.                                               â”‚
â”‚     â€¢ Update UI:                                                                                                     â”‚
â”‚        â€¢ #status-name = activeLoot.name                                                                              â”‚
â”‚        â€¢ #status-year = activeLoot.year                                                                              â”‚
â”‚        â€¢ #status-clue = "Clue: " + activeLoot.clue                                                                   â”‚
â”‚        â€¢ #verse-text = activeLoot.verse                                                                              â”‚
â”‚     â€¢ Find a panorama near activeLoot.coords:                                                                        â”‚
â”‚        â€¢ Use STATE.streetViewService.getPanorama({ location: activeLoot.coords, radius: 250, preference: "nearest"   â”‚
â”‚          }, callback)                                                                                                â”‚
â”‚        â€¢ If not found, expand radius to 500, then 1000. If still not found, showToast("No Street View near this      â”‚
â”‚          location") and abort.                                                                                       â”‚
â”‚     â€¢ Set STATE.streetView to that pano and set position/POV.                                                        â”‚
â”‚     â€¢ Update STATE.currentPos to the panoâ€™s lat/lng.                                                                 â”‚
â”‚     â€¢ Update minimap:                                                                                                â”‚
â”‚        â€¢ Center on STATE.currentPos                                                                                  â”‚
â”‚        â€¢ Create/update markers:                                                                                      â”‚
â”‚           â€¢ me: current position (blue-ish marker)                                                                   â”‚
â”‚           â€¢ target: destination (red marker)                                                                         â”‚
â”‚     â€¢ Enable #btn-trail (remove disabled).                                                                           â”‚
â”‚     â€¢ Start a short interval (e.g., every 1s) to recompute distance using haversineDistance(STATE.currentPos.lat,    â”‚
â”‚       STATE.currentPos.lng, STATE.activeLoot.coords.lat, STATE.activeLoot.coords.lng) and update #status-distance    â”‚
â”‚       text like â€œDistance: 123 mâ€.                                                                                   â”‚
â”‚  â€¢ toggleTrailMode():                                                                                                â”‚
â”‚     â€¢ If STATE.trailModeActive is false:                                                                             â”‚
â”‚        â€¢ Check preconditions: STATE.streetView exists, STATE.activeLoot exists.                                      â”‚
â”‚        â€¢ Call calculateRoute(). If successful, drawRoute() and start advanceAlongRoute().                            â”‚
â”‚        â€¢ Update UI state (button active style).                                                                      â”‚
â”‚        â€¢ If any step fails, showToast with a friendly message, playSound('boom'), and ensure STATE.trailModeActive   â”‚
â”‚          is false.                                                                                                   â”‚
â”‚     â€¢ If STATE.trailModeActive is true:                                                                              â”‚
â”‚        â€¢ Stop any pending timers (clearInterval/clearTimeout).                                                       â”‚
â”‚        â€¢ Remove/dim route polyline and set STATE.routePolyline = null.                                               â”‚
â”‚        â€¢ Reset waypoints/waypointIndex.                                                                              â”‚
â”‚        â€¢ Update UI state (button normal style).                                                                      â”‚
â”‚        â€¢ Set STATE.trailModeActive = false.                                                                          â”‚
â”‚  â€¢ calculateRoute():                                                                                                 â”‚
â”‚     â€¢ setLoading(true)                                                                                               â”‚
â”‚     â€¢ Use STATE.directionsService.route({ origin: STATE.currentPos, destination: STATE.activeLoot.coords,            â”‚
â”‚       travelMode: google.maps.TravelMode.WALKING }, callback)                                                        â”‚
â”‚     â€¢ On success:                                                                                                    â”‚
â”‚        â€¢ Extract overview_polyline or steps into an ordered list of LatLng points.                                   â”‚
â”‚        â€¢ Decode using google.maps.geometry.encoding.decodePath if using overview_polyline.                           â”‚
â”‚        â€¢ Map points into STATE.waypoints = [{ lat, lng }, ...]                                                       â”‚
â”‚        â€¢ If fewer than ~2 points, treat as failure.                                                                  â”‚
â”‚     â€¢ On failure:                                                                                                    â”‚
â”‚        â€¢ showToast("Unable to calculate walking route"); playSound('boom')                                           â”‚
â”‚     â€¢ Always setLoading(false)                                                                                       â”‚
â”‚     â€¢ Return a boolean for success/failure.                                                                          â”‚
â”‚  â€¢ drawRoute():                                                                                                      â”‚
â”‚     â€¢ If STATE.routePolyline exists, remove it from map first.                                                       â”‚
â”‚     â€¢ Create a new google.maps.Polyline({ path: STATE.waypoints.map(p => ({ lat: p.lat, lng: p.lng })), map:         â”‚
â”‚       STATE.map, strokeColor: '#1e90ff', strokeOpacity: 0.9, strokeWeight: 4 })                                      â”‚
â”‚     â€¢ Assign to STATE.routePolyline.                                                                                 â”‚
â”‚     â€¢ Fit minimap bounds to include current position and target and most of the route.                               â”‚
â”‚  â€¢ advanceAlongRoute():                                                                                              â”‚
â”‚     â€¢ Set STATE.trailModeActive = true                                                                               â”‚
â”‚     â€¢ Use an interval, e.g., every 1200 ms:                                                                          â”‚
â”‚        â€¢ If waypointIndex >= waypoints.length: stop trail mode gracefully.                                           â”‚
â”‚        â€¢ Let wp = STATE.waypoints[STATE.waypointIndex]                                                               â”‚
â”‚        â€¢ Find nearest panorama near wp using STATE.streetViewService.getPanorama({ location: wp, radius: 60,         â”‚
â”‚          preference: "nearest" }, cb)                                                                                â”‚
â”‚           â€¢ If not found, increment waypointIndex and continue (skip).                                               â”‚
â”‚           â€¢ If found:                                                                                                â”‚
â”‚              â€¢ Set STATE.streetView.setPano(result.location.pano) or setPosition(result.location.latLng)             â”‚
â”‚              â€¢ Compute heading from current pano latLng to next waypoint (use                                        â”‚
â”‚                google.maps.geometry.spherical.computeHeading)                                                        â”‚
â”‚              â€¢ Set POV with setPov({ heading, pitch: 0 })                                                            â”‚
â”‚              â€¢ Update STATE.currentPos = pano location                                                               â”‚
â”‚              â€¢ Update #status-distance                                                                               â”‚
â”‚              â€¢ Update â€œmeâ€ marker on minimap                                                                         â”‚
â”‚              â€¢ playSound('warp')                                                                                     â”‚
â”‚              â€¢ Increment waypointIndex                                                                               â”‚
â”‚        â€¢ Stop condition:                                                                                             â”‚
â”‚           â€¢ If haversineDistance between STATE.currentPos and STATE.activeLoot.coords <= 25 meters:                  â”‚
â”‚              â€¢ Stop timers and Trail Mode                                                                            â”‚
â”‚              â€¢ showToast("Arrived!"), playSound('collect')                                                           â”‚
â”‚              â€¢ Keep polyline visible but dim or remove as you see fit                                                â”‚
â”‚              â€¢ Update UI state (Trail button off)                                                                    â”‚
â”‚     â€¢ Ensure defensive checks in callback paths (component may be toggled off mid-request).                          â”‚
â”‚  â€¢ setStreetViewToLatLng(lat, lng, options?): Promise:                                                               â”‚
â”‚     â€¢ A small helper that sets streetview position and POV, returns a Promise resolved after idle or a short timeout â”‚
â”‚       to let view update.                                                                                            â”‚
â”‚  â€¢ findNearestPanoTo(lat, lng, radius=50): Promise:                                                                  â”‚
â”‚     â€¢ Wraps StreetViewService.getPanorama in a Promise; resolves with pano data or null.                             â”‚
â”‚  â€¢ updateDistanceUI():                                                                                               â”‚
â”‚     â€¢ Recompute distance every second or when movement occurs.                                                       â”‚
â”‚     â€¢ Update #status-distance to â€œDistance: X mâ€ (rounded) or â€œX.X kmâ€ if >= 1000 m.                                 â”‚
â”‚  â€¢ updateMarkers():                                                                                                  â”‚
â”‚     â€¢ If markers donâ€™t exist, create them with new google.maps.Marker({ position: ..., map: STATE.map, ... });       â”‚
â”‚     â€¢ Update positions for â€œmeâ€ and â€œtargetâ€.                                                                        â”‚
â”‚  â€¢ setTrailButtonActive(active):                                                                                     â”‚
â”‚     â€¢ Adds/removes an â€œactiveâ€ CSS class on #btn-trail for styling.                                                  â”‚
â”‚                                                                                                                      â”‚
â”‚ Audio handling:                                                                                                      â”‚
â”‚                                                                                                                      â”‚
â”‚  â€¢ Preload three Audio objects for boom, collect, warp.                                                              â”‚
â”‚  â€¢ playSound(name) must catch playback errors (e.g., autoplay restrictions) and fail silently with console.info.     â”‚
â”‚                                                                                                                      â”‚
â”‚ Error handling and logging:                                                                                          â”‚
â”‚                                                                                                                      â”‚
â”‚  â€¢ Wrap Maps API calls with try/catch or defensive callbacks.                                                        â”‚
â”‚  â€¢ On API errors (e.g., OVER_QUERY_LIMIT), show a Toast with short message and console.error the details.            â”‚
â”‚  â€¢ If the Google Maps script fails to load, show a centered message instructing the user to insert API key.          â”‚
â”‚                                                                                                                      â”‚
â”‚ Keyboard shortcuts (optional but preferred):                                                                         â”‚
â”‚                                                                                                                      â”‚
â”‚  â€¢ Key "I" -> click â€œINITIATE SEQUENCEâ€                                                                              â”‚
â”‚  â€¢ Key "T" -> toggleTrailMode()                                                                                      â”‚
â”‚  â€¢ Ignore shortcuts if buttons are disabled.                                                                         â”‚
â”‚                                                                                                                      â”‚
â”‚ Accessibility:                                                                                                       â”‚
â”‚                                                                                                                      â”‚
â”‚  â€¢ Buttons must be accessible with proper aria-label and focus styles.                                               â”‚
â”‚  â€¢ The toast uses role="status" aria-live="polite".                                                                  â”‚
â”‚  â€¢ Ensure sufficient contrast for toolbar and verse bar.                                                             â”‚
â”‚                                                                                                                      â”‚
â”‚ Button enabling/disabling:                                                                                           â”‚
â”‚                                                                                                                      â”‚
â”‚  â€¢ #btn-trail is disabled until:                                                                                     â”‚
â”‚     â€¢ A level is started (STATE.activeLoot != null)                                                                  â”‚
â”‚     â€¢ Street View has initialized a valid pano (STATE.currentPos has finite numbers)                                 â”‚
â”‚  â€¢ While calculateRoute or panorama jump is in progress, show #spinner.                                              â”‚
â”‚                                                                                                                      â”‚
â”‚ Distance formatting:                                                                                                 â”‚
â”‚                                                                                                                      â”‚
â”‚  â€¢ If distance < 1000: show â€œDistance: N mâ€ where N is integer.                                                      â”‚
â”‚  â€¢ Else: show â€œDistance: K.K kmâ€ to one decimal.                                                                     â”‚
â”‚                                                                                                                      â”‚
â”‚ Minimap details:                                                                                                     â”‚
â”‚                                                                                                                      â”‚
â”‚  â€¢ Keep minimap small (200x200) bottom-left.                                                                         â”‚
â”‚  â€¢ Use a subtle custom marker color for the â€œmeâ€ marker and a distinct red for â€œtargetâ€.                             â”‚
â”‚  â€¢ Update the map center to follow current position occasionally but avoid jitter (e.g., every 3-5 steps).           â”‚
â”‚                                                                                                                      â”‚
â”‚ Defensive details:                                                                                                   â”‚
â”‚                                                                                                                      â”‚
â”‚  â€¢ Always use STATE.activeLoot.coords.lat and STATE.activeLoot.coords.lng (never .target).                           â”‚
â”‚  â€¢ If HUNT_LOCATIONS_WITH_PATHS is absent, use fallback dataset bundled in the file.                                 â”‚
â”‚  â€¢ If no route can be calculated or Street View pano cannot be found near waypoints, auto-stop Trail Mode and inform â”‚
â”‚    the user with a toast.                                                                                            â”‚
â”‚                                                                                                                      â”‚
â”‚ Acceptance criteria (must all pass):                                                                                 â”‚
â”‚                                                                                                                      â”‚
â”‚  1 INITIATE SEQUENCE selects a random entry from HUNT_LOCATIONS_WITH_PATHS and updates UI: name, year, clue, verse.  â”‚
â”‚  2 Street View loads near the target within reasonable radius (<= 1000m).                                            â”‚
â”‚  3 Distance to target displays and updates as the user moves (manually or via Trail Mode).                           â”‚
â”‚  4 Trail Mode calculates a WALKING route, draws a polyline on the minimap, and automatically advances through Street â”‚
â”‚    View panoramas toward the target.                                                                                 â”‚
â”‚  5 Arrival is detected within 25 meters, Trail Mode stops, and collect.wav plays.                                    â”‚
â”‚  6 The app never references STATE.activeLoot.target, only STATE.activeLoot.coords.                                   â”‚
â”‚  7 The app runs when served locally and the API key is inserted.                                                     â”‚
â”‚                                                                                                                      â”‚
â”‚ Testing notes:                                                                                                       â”‚
â”‚                                                                                                                      â”‚
â”‚  â€¢ Provide console.log messages for lifecycle events:                                                                â”‚
â”‚     â€¢ â€œLevel started at â€¦â€                                                                                           â”‚
â”‚     â€¢ â€œRoute calculated with N pointsâ€                                                                               â”‚
â”‚     â€¢ â€œAdvancing to waypoint i/Nâ€                                                                                    â”‚
â”‚     â€¢ â€œPanorama not found near waypointâ€”skippingâ€                                                                    â”‚
â”‚     â€¢ â€œArrived at destinationâ€                                                                                       â”‚
â”‚  â€¢ Provide clear error logs for:                                                                                     â”‚
â”‚     â€¢ DirectionsService errors                                                                                       â”‚
â”‚     â€¢ StreetViewService errors                                                                                       â”‚
â”‚     â€¢ Audio playback issues                                                                                          â”‚
â”‚  â€¢ Use try/finally to hide the spinner after async work.                                                             â”‚
â”‚                                                                                                                      â”‚
â”‚ Final note:                                                                                                          â”‚
â”‚                                                                                                                      â”‚
â”‚  â€¢ Include a short top-of-file comment block:                                                                        â”‚
â”‚     â€¢ Instructions to insert Google Maps API key                                                                     â”‚
â”‚     â€¢ Reminder to serve via a local web server (e.g., python -m http.server 8000)                                    â”‚
â”‚