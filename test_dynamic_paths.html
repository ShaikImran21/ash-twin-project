<!doctype html>
<html>
    <head>
        <title>Dynamic Adventure Paths - Test</title>
        <style>
            body {
                font-family: 'Courier New', monospace;
                background: #0a0a0a;
                color: #0f0;
                padding: 20px;
                max-width: 1200px;
                margin: 0 auto;
            }
            h1 {
                color: #0af;
                text-align: center;
            }
            .controls {
                background: #1a1a1a;
                padding: 20px;
                border: 2px solid #0af;
                margin: 20px 0;
                display: flex;
                gap: 10px;
                flex-wrap: wrap;
            }
            button {
                background: #003366;
                color: #0af;
                border: 2px solid #0af;
                padding: 10px 20px;
                cursor: pointer;
                font-family: inherit;
                font-size: 14px;
            }
            button:hover {
                background: #004488;
            }
            button:disabled {
                opacity: 0.5;
                cursor: not-allowed;
            }
            select {
                background: #1a1a1a;
                color: #0f0;
                border: 2px solid #0f0;
                padding: 10px;
                font-family: inherit;
            }
            .output {
                background: #0a0a0a;
                border: 2px solid #0f0;
                padding: 20px;
                margin: 20px 0;
                min-height: 200px;
                white-space: pre-wrap;
                font-size: 12px;
            }
            .path-card {
                background: #1a1a1a;
                border: 2px solid #0af;
                padding: 15px;
                margin: 10px 0;
            }
            .waypoint {
                background: #002200;
                padding: 10px;
                margin: 5px 0;
                border-left: 3px solid #0f0;
            }
            .main-dest {
                background: #003366;
                padding: 15px;
                margin: 10px 0;
                border: 3px solid #0af;
            }
            .error {
                color: #f00;
                background: #220000;
                padding: 10px;
                border: 2px solid #f00;
            }
            .success {
                color: #0f0;
                background: #002200;
                padding: 10px;
                border: 2px solid #0f0;
            }
            .loading {
                color: #ff0;
                text-align: center;
                font-size: 18px;
            }
        </style>
    </head>
    <body>
        <h1>ğŸŒ Dynamic Adventure Path Generator - Test</h1>

        <div class="controls">
            <select id="city-select">
                <option value="">Select City...</option>
                <option value="Tokyo">ğŸ—¾ Tokyo</option>
                <option value="Kyoto">ğŸ¯ Kyoto</option>
                <option value="Osaka">ğŸ™ï¸ Osaka</option>
                <option value="Paris">ğŸ—¼ Paris</option>
                <option value="London">ğŸ° London</option>
                <option value="New York">ğŸ—½ New York</option>
                <option value="Rome">ğŸ›ï¸ Rome</option>
                <option value="Barcelona">âš½ Barcelona</option>
                <option value="Amsterdam">ğŸš² Amsterdam</option>
                <option value="Singapore">ğŸ¦ Singapore</option>
            </select>

            <select id="difficulty-select">
                <option value="easy">Easy (4 waypoints)</option>
                <option value="medium" selected>Medium (6 waypoints)</option>
                <option value="hard">Hard (8 waypoints)</option>
            </select>

            <button id="generate-btn" onclick="generatePath()">ğŸ² Generate Path</button>
            <button onclick="testMultiple()">ğŸ”„ Generate 3 Paths</button>
            <button onclick="clearOutput()">ğŸ—‘ï¸ Clear</button>
        </div>

        <div id="status" class="output"></div>
        <div id="results"></div>

        <!-- Load Google Maps API -->
        <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAvCO_bcpW5Zuh-Wmizb9AuH8_RxHl6BVY&libraries=places"></script>

        <!-- Load dynamic system -->
        <script src="dynamic_adventure_paths.js"></script>

        <script>
            let generator = null;
            let map = null;

            // Initialize
            window.addEventListener('load', () => {
                log('ğŸ® Initializing Dynamic Adventure Path System...');

                // Create a hidden map for Places API
                const mapDiv = document.createElement('div');
                mapDiv.style.display = 'none';
                document.body.appendChild(mapDiv);

                map = new google.maps.Map(mapDiv, {
                    center: { lat: 35.6762, lng: 139.6503 },
                    zoom: 12,
                });

                generator = new DynamicAdventureGenerator(
                    'AIzaSyAvCO_bcpW5Zuh-Wmizb9AuH8_RxHl6BVY'
                );
                generator.init(map);

                log('âœ… System initialized and ready!', 'success');
                log('ğŸ’¡ Select a city and click "Generate Path"', 'info');
            });

            function log(message, type = 'info') {
                const status = document.getElementById('status');
                const div = document.createElement('div');
                div.className = type === 'success' ? 'success' : type === 'error' ? 'error' : '';
                div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
                status.appendChild(div);
                status.scrollTop = status.scrollHeight;
            }

            async function generatePath() {
                const cityName = document.getElementById('city-select').value;
                const difficulty = document.getElementById('difficulty-select').value;

                if (!cityName) {
                    log('âš ï¸ Please select a city first', 'error');
                    return;
                }

                const btn = document.getElementById('generate-btn');
                btn.disabled = true;
                btn.textContent = 'â³ Generating...';

                const cityCoords = {
                    Tokyo: { lat: 35.6762, lng: 139.6503, radius: 5000 },
                    Kyoto: { lat: 35.0116, lng: 135.7681, radius: 4000 },
                    Osaka: { lat: 34.6937, lng: 135.5023, radius: 4000 },
                    Paris: { lat: 48.8566, lng: 2.3522, radius: 5000 },
                    London: { lat: 51.5074, lng: -0.1278, radius: 5000 },
                    'New York': { lat: 40.7128, lng: -74.006, radius: 5000 },
                    Rome: { lat: 41.9028, lng: 12.4964, radius: 4000 },
                    Barcelona: { lat: 41.3851, lng: 2.1734, radius: 4000 },
                    Amsterdam: { lat: 52.3676, lng: 4.9041, radius: 3000 },
                    Singapore: { lat: 1.3521, lng: 103.8198, radius: 4000 },
                };

                const city = cityCoords[cityName];
                city.name = cityName;

                try {
                    log(`ğŸ² Generating ${difficulty} path for ${cityName}...`);

                    const path = await generator.generateAdventurePath(
                        city,
                        city.radius,
                        difficulty
                    );

                    log(`âœ… Path generated successfully!`, 'success');
                    displayPath(path, cityName);
                } catch (error) {
                    log(`âŒ Error: ${error.message}`, 'error');
                    console.error(error);
                } finally {
                    btn.disabled = false;
                    btn.textContent = 'ğŸ² Generate Path';
                }
            }

            function displayPath(path, cityName) {
                const results = document.getElementById('results');

                const card = document.createElement('div');
                card.className = 'path-card';

                let html = `
                <h2>ğŸ—ºï¸ ${cityName} - ${path.name}</h2>
                <p>ğŸ“Š Difficulty: ${path.difficulty} | â±ï¸ Time: ${path.estimatedTime}</p>
                <p>ğŸ†” Path ID: ${path.pathId}</p>
                <hr style="border-color: #0af;">
            `;

                // Main destination
                html += `
                <div class="main-dest">
                    <h3>ğŸ MAIN DESTINATION</h3>
                    <p><strong>${path.mainDestination.emoji} ${path.mainDestination.name}</strong></p>
                    <p>${path.mainDestination.description}</p>
                    <p>ğŸ“ ${path.mainDestination.coords.lat.toFixed(6)}, ${path.mainDestination.coords.lng.toFixed(6)}</p>
                    ${path.mainDestination.rating ? `<p>â­ Rating: ${path.mainDestination.rating}/5</p>` : ''}
                    ${path.mainDestination.address ? `<p>ğŸ“® ${path.mainDestination.address}</p>` : ''}
                </div>
            `;

                // Waypoints
                html += `<h3>ğŸ“ WAYPOINTS (${path.waypoints.length})</h3>`;
                path.waypoints.forEach((wp, index) => {
                    html += `
                    <div class="waypoint">
                        <strong>${wp.order}. ${wp.emoji} ${wp.name}</strong><br>
                        ${wp.description}<br>
                        ğŸ“ ${wp.coords.lat.toFixed(6)}, ${wp.coords.lng.toFixed(6)}<br>
                        ${wp.challenge ? `ğŸ¯ Challenge: ${wp.challenge}` : ''}
                    </div>
                `;
                });

                card.innerHTML = html;
                results.insertBefore(card, results.firstChild);
            }

            async function testMultiple() {
                log('ğŸ”„ Generating 3 paths in different difficulties...');

                const city = document.getElementById('city-select').value;
                if (!city) {
                    log('âš ï¸ Please select a city first', 'error');
                    return;
                }

                for (const difficulty of ['easy', 'medium', 'hard']) {
                    document.getElementById('difficulty-select').value = difficulty;
                    await generatePath();
                    await new Promise(resolve => setTimeout(resolve, 2000)); // Wait 2s between requests
                }

                log('âœ… All 3 paths generated!', 'success');
            }

            function clearOutput() {
                document.getElementById('status').innerHTML = '';
                document.getElementById('results').innerHTML = '';
                log('ğŸ—‘ï¸ Output cleared');
            }
        </script>
    </body>
</html>
