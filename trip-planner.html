<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trip Planner - Voyager</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;600;700&family=Montserrat:wght@300;400;500;600;700&family=Nunito:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="enhanced-styles.css">
    <link rel="stylesheet" href="pages-styles.css">
    <style>
        /* Search Section */
        .search-section {
            margin: -100px auto 4rem;
            max-width: 900px;
            position: relative;
            z-index: 10;
        }

        .search-container {
            background: var(--bg-glass);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            border-radius: 24px;
            border: 1px solid var(--border-color);
            padding: 2.5rem;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
        }

        .search-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .search-box {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .search-input {
            flex: 1;
            padding: 1.2rem 1.5rem;
            border: 2px solid var(--border-color);
            border-radius: 50px;
            font-size: 1.1rem;
            background: var(--bg-secondary);
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary-gold);
            box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.1);
        }

        .search-button {
            padding: 1.2rem 2.5rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .search-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .search-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .quick-searches {
            display: flex;
            gap: 0.8rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        .quick-search-btn {
            padding: 0.5rem 1.2rem;
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            border: 1px solid rgba(102, 126, 234, 0.3);
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quick-search-btn:hover {
            background: rgba(102, 126, 234, 0.2);
            transform: translateY(-2px);
        }

        /* Loading Spinner */
        .loading {
            text-align: center;
            padding: 3rem;
            color: var(--text-secondary);
            font-size: 1.2rem;
        }

        .spinner {
            border: 4px solid var(--border-color);
            border-top: 4px solid var(--primary-gold);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Results Section */
        .results-section {
            padding: 2rem 0 4rem;
            display: none;
        }

        .results-section.active {
            display: block;
        }

        .location-info {
            background: var(--bg-glass);
            backdrop-filter: blur(20px) saturate(180%);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 3rem;
            border: 1px solid var(--border-color);
        }

        .location-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .location-name {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .location-country {
            font-size: 1.2rem;
            color: var(--text-secondary);
        }

        .location-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .stat-item {
            text-align: center;
            padding: 1rem;
            background: rgba(102, 126, 234, 0.05);
            border-radius: 12px;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary-gold);
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: 0.3rem;
        }

        /* Photos Gallery */
        .photos-section {
            margin-top: 3rem;
        }

        .section-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 2rem;
        }

        .photos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .photo-card {
            position: relative;
            border-radius: 16px;
            overflow: hidden;
            cursor: pointer;
            aspect-ratio: 4/3;
            background: var(--bg-glass);
            border: 1px solid var(--border-color);
        }

        .photo-card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .photo-card:hover img {
            transform: scale(1.1);
        }

        .photo-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
            padding: 1.5rem 1rem 1rem;
            color: white;
            transform: translateY(100%);
            transition: transform 0.3s ease;
        }

        .photo-card:hover .photo-overlay {
            transform: translateY(0);
        }

        .photo-title {
            font-weight: 600;
            font-size: 1rem;
        }

        .photo-photographer {
            font-size: 0.85rem;
            opacity: 0.9;
            margin-top: 0.3rem;
        }


        /* Attractions Section */
        .attractions-section {
            margin-top: 3rem;
        }

        .attractions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 2rem;
        }

        .attraction-card {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(30px) saturate(180%);
            -webkit-backdrop-filter: blur(30px) saturate(180%);
            border-radius: 24px;
            padding: 0;
            border: 1px solid rgba(157, 78, 221, 0.2);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .attraction-image {
            width: 100%;
            height: 250px;
            object-fit: cover;
            border-radius: 24px 24px 0 0;
            position: relative;
            filter: brightness(0.95) contrast(1.05);
        }

        .attraction-image-wrapper {
            position: relative;
            overflow: hidden;
            border-radius: 24px 24px 0 0;
        }

        .attraction-image-wrapper::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(
                135deg,
                rgba(255, 255, 255, 0.1) 0%,
                rgba(255, 255, 255, 0) 50%,
                rgba(0, 0, 0, 0.2) 100%
            );
            z-index: 1;
            pointer-events: none;
            mix-blend-mode: overlay;
        }

        .attraction-image-wrapper::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                90deg,
                transparent,
                rgba(255, 255, 255, 0.3),
                transparent
            );
            z-index: 2;
            pointer-events: none;
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% {
                left: -100%;
            }
            50%, 100% {
                left: 100%;
            }
        }

        .attraction-card:hover .attraction-image {
            transform: scale(1.05);
            transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .liquid-glass-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(
                circle at 30% 50%,
                rgba(255, 255, 255, 0.15) 0%,
                rgba(255, 255, 255, 0.05) 50%,
                transparent 100%
            );
            backdrop-filter: blur(0px);
            z-index: 1;
            pointer-events: none;
            transition: backdrop-filter 0.3s ease;
        }

        .attraction-card:hover .liquid-glass-overlay {
            backdrop-filter: blur(2px);
        }

        .attraction-content {
            padding: 1.5rem;
        }

        .attraction-image-credit {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.75);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            color: white;
            padding: 0.4rem 0.8rem;
            border-radius: 12px;
            font-size: 0.7rem;
            z-index: 3;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .attraction-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(157, 78, 221, 0.1), rgba(247, 37, 133, 0.1));
            opacity: 0;
            transition: opacity 0.4s ease;
            pointer-events: none;
        }

        .attraction-card:hover::before {
            opacity: 1;
        }

        .attraction-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 60px rgba(157, 78, 221, 0.4);
            border-color: rgba(157, 78, 221, 0.5);
        }

        .attraction-name {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .attraction-type {
            display: inline-block;
            padding: 0.4rem 1rem;
            background: linear-gradient(135deg, rgba(157, 78, 221, 0.15), rgba(247, 37, 133, 0.15));
            color: #9D4EDD;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 1rem;
            border: 1px solid rgba(157, 78, 221, 0.3);
        }

        .attraction-info {
            color: var(--text-secondary);
            line-height: 1.6;
            margin-top: 0.8rem;
        }

        .attraction-distance {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid rgba(157, 78, 221, 0.15);
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .attraction-actions {
            display: flex;
            gap: 0.8rem;
            margin-top: 1.2rem;
        }

        .learn-more-btn {
            flex: 1;
            padding: 0.7rem 1.2rem;
            background: linear-gradient(135deg, rgba(157, 78, 221, 0.2), rgba(114, 9, 183, 0.2));
            border: 1px solid rgba(157, 78, 221, 0.4);
            color: #9D4EDD;
            border-radius: 12px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .learn-more-btn:hover {
            background: linear-gradient(135deg, rgba(157, 78, 221, 0.3), rgba(114, 9, 183, 0.3));
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(157, 78, 221, 0.3);
        }

        /* Attraction Detail Modal */
        .attraction-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(10, 14, 39, 0.95);
            backdrop-filter: blur(10px);
            z-index: 2000;
            overflow-y: auto;
            padding: 2rem;
        }

        .attraction-modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .attraction-modal-content {
            background: linear-gradient(135deg, rgba(26, 31, 58, 0.98), rgba(10, 14, 39, 0.98));
            backdrop-filter: blur(40px) saturate(180%);
            border-radius: 32px;
            padding: 3rem;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            border: 1px solid rgba(157, 78, 221, 0.3);
            box-shadow: 0 30px 90px rgba(157, 78, 221, 0.5);
        }

        .attraction-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 2px solid rgba(157, 78, 221, 0.2);
        }

        .attraction-modal-title {
            font-size: 2.2rem;
            font-weight: 700;
            color: #F8F9FA;
            margin-bottom: 0.5rem;
        }

        .attraction-modal-type {
            display: inline-block;
            padding: 0.5rem 1.2rem;
            background: linear-gradient(135deg, rgba(157, 78, 221, 0.2), rgba(247, 37, 133, 0.2));
            color: #9D4EDD;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            border: 1px solid rgba(157, 78, 221, 0.4);
        }

        .close-attraction-modal {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #ef4444;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 0.5rem;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
        }

        .close-attraction-modal:hover {
            background: rgba(239, 68, 68, 0.2);
            transform: rotate(90deg);
        }

        .attraction-modal-body {
            margin-top: 2rem;
        }

        .attraction-detail-section {
            margin-bottom: 2rem;
        }

        .attraction-detail-section h3 {
            font-size: 1.3rem;
            font-weight: 600;
            color: #FFD700;
            margin-bottom: 1rem;
        }

        .attraction-detail-section p {
            color: #B4B4C8;
            line-height: 1.8;
            font-size: 1rem;
        }

        .attraction-meta {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 2rem;
        }

        .meta-item {
            background: rgba(157, 78, 221, 0.08);
            padding: 1rem;
            border-radius: 16px;
            border: 1px solid rgba(157, 78, 221, 0.2);
        }

        .meta-label {
            font-size: 0.85rem;
            color: #B4B4C8;
            margin-bottom: 0.3rem;
        }

        .meta-value {
            font-size: 1.1rem;
            font-weight: 600;
            color: #F8F9FA;
        }

        .wikipedia-link {
            display: inline-block;
            margin-top: 1rem;
            padding: 0.8rem 1.5rem;
            background: linear-gradient(135deg, #4CC9F0, #3A9FC9);
            color: white;
            border-radius: 12px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .wikipedia-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(76, 201, 240, 0.4);
        }

        .no-results {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-secondary);
        }

        .no-results h3 {
            font-size: 1.8rem;
            color: var(--text-primary);
            margin-bottom: 1rem;
        }

        /* Itinerary Planner Styles */
        .itinerary-actions {
            position: sticky;
            top: 80px;
            z-index: 100;
            background: var(--bg-glass);
            backdrop-filter: blur(20px) saturate(180%);
            border-radius: 16px;
            padding: 1.5rem;
            margin: 2rem 0;
            border: 2px solid var(--primary-gold);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            display: none;
        }

        .itinerary-actions.visible {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .selected-count {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .selected-count span {
            color: var(--primary-gold);
            font-size: 1.3rem;
        }

        .create-itinerary-btn {
            padding: 1rem 2.5rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .create-itinerary-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.5);
        }

        .attraction-card {
            position: relative;
        }

        .attraction-select {
            position: absolute;
            top: 10px;
            left: 10px;
            width: 28px;
            height: 28px;
            cursor: pointer;
            z-index: 10;
            accent-color: var(--primary-purple);
            background: rgba(255, 255, 255, 0.95);
            border-radius: 6px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .attraction-card.selected {
            border: 2px solid var(--primary-gold);
            background: rgba(212, 175, 55, 0.05);
        }

        /* Itinerary Modal */
        .itinerary-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            overflow-y: auto;
            padding: 2rem;
        }

        .itinerary-modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .itinerary-content {
            background: var(--bg-primary);
            border-radius: 24px;
            padding: 3rem;
            max-width: 900px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .itinerary-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--border-color);
        }

        .itinerary-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 2rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 0;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-modal:hover {
            color: var(--text-primary);
            transform: rotate(90deg);
        }

        .trip-days {
            margin-top: 2rem;
        }

        .day-section {
            background: var(--bg-glass);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 1px solid var(--border-color);
        }

        .day-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .day-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--primary-gold);
        }

        .day-places {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .itinerary-place {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid var(--border-color);
        }

        .place-info h4 {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.3rem;
        }

        .place-info p {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .place-actions {
            display: flex;
            gap: 0.5rem;
        }

        .move-btn, .remove-btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .move-btn {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
        }

        .move-btn:hover {
            background: rgba(102, 126, 234, 0.2);
        }

        .remove-btn {
            background: rgba(239, 68, 68, 0.1);
            color: #ef4444;
        }

        .remove-btn:hover {
            background: rgba(239, 68, 68, 0.2);
        }

        .add-day-btn {
            width: 100%;
            padding: 1rem;
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            border: 2px dashed rgba(102, 126, 234, 0.3);
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 1rem;
        }

        .add-day-btn:hover {
            background: rgba(102, 126, 234, 0.2);
            border-color: rgba(102, 126, 234, 0.5);
        }

        .itinerary-actions-bottom {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 2px solid var(--border-color);
        }

        .export-btn, .save-btn {
            flex: 1;
            padding: 1rem 2rem;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .export-btn {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .save-btn {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .export-btn:hover, .save-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">
                <svg class="logo-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 18v-6a9 9 0 0 1 18 0v6"></path>
                    <path d="M21 19a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3zM3 19a2 2 0 0 0 2 2h1a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2H3z"></path>
                </svg>
                <span class="logo-text">VOYAGER</span>
            </div>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="transportation.html">Transportation</a></li>
                <li><a href="trip-planner.html" class="active">Trip Planner</a></li>
                <li><a href="ar-experience.html">AR Experience</a></li>
                <li>
                    <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle dark mode">
                        <span class="theme-icon sun">‚òÄÔ∏è</span>
                        <span class="theme-icon moon">üåô</span>
                    </button>
                </li>
                <li id="nav-auth-btn"><a href="http://localhost:3000/login-appwrite.html" class="nav-btn">Login / Sign Up</a></li>
            </ul>
            <button class="mobile-menu-btn" onclick="toggleMobileMenu()">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </nav>

    <!-- Page Hero -->
    <section class="page-hero">
        <div class="hero-overlay"></div>
        <div class="hero-content">
            <p class="hero-subtitle">Plan Your Adventure</p>
            <h1 class="hero-title">Trip Planner</h1>
            <p class="hero-description">Search any location and discover attractions with stunning photos</p>
        </div>
    </section>

    <!-- Search Section -->
    <div class="container">
        <div class="search-section">
            <div class="search-container">
                <h2 class="search-title">üåç Where do you want to go?</h2>
                <div class="search-box">
                    <input 
                        type="text" 
                        class="search-input" 
                        id="location-search"
                        placeholder="Enter a city, country, or landmark..."
                        onkeypress="handleSearchKeypress(event)">
                    <button class="search-button" onclick="searchLocation()" id="search-btn">
                        Search
                    </button>
                </div>
                <div class="quick-searches">
                    <span style="color: var(--text-secondary); font-size: 0.9rem;">Quick search:</span>
                    <button class="quick-search-btn" onclick="quickSearch('Paris')">Paris üóº</button>
                    <button class="quick-search-btn" onclick="quickSearch('Tokyo')">Tokyo üóæ</button>
                    <button class="quick-search-btn" onclick="quickSearch('New York')">New York üóΩ</button>
                    <button class="quick-search-btn" onclick="quickSearch('Bali')">Bali üèùÔ∏è</button>
                    <button class="quick-search-btn" onclick="quickSearch('Dubai')">Dubai üèôÔ∏è</button>
                </div>
            </div>
        </div>

        <!-- Loading State -->
        <div id="loading-state" class="loading" style="display: none;">
            <div class="spinner"></div>
            <p>Searching for amazing places...</p>
        </div>

        <!-- Results Section -->
        <div id="results-section" class="results-section">
            <!-- Location Info -->
            <div id="location-info" class="location-info"></div>

            <!-- Itinerary Actions Bar -->
            <div id="itinerary-actions" class="itinerary-actions">
                <div class="selected-count">
                    <span id="selected-count">0</span> attractions selected
                </div>
                <button class="create-itinerary-btn" onclick="openItineraryModal()">
                    üìÖ Create Travel Plan
                </button>
            </div>

            <!-- Photos Section -->
            <div class="photos-section">
                <h2 class="section-title">üì∏ Photos</h2>
                <div id="photos-grid" class="photos-grid"></div>
            </div>

            <!-- Attractions Section -->
            <div class="attractions-section">
                <h2 class="section-title">üèõÔ∏è Select Attractions for Your Trip</h2>
                <p style="color: var(--text-secondary); margin-bottom: 2rem;">Click the checkbox on each attraction to add it to your travel plan</p>
                <div id="attractions-grid" class="attractions-grid"></div>
            </div>
        </div>

        <!-- No Results -->
        <div id="no-results" class="no-results" style="display: none;">
            <h3>No results found</h3>
            <p>Try searching for a popular city or tourist destination</p>
        </div>
    </div>

    <!-- Attraction Detail Modal -->
    <div id="attraction-modal" class="attraction-modal">
        <div class="attraction-modal-content">
            <div class="attraction-modal-header">
                <div>
                    <h2 class="attraction-modal-title" id="modal-attraction-name"></h2>
                    <span class="attraction-modal-type" id="modal-attraction-type"></span>
                </div>
                <button class="close-attraction-modal" onclick="closeAttractionModal()">√ó</button>
            </div>
            <div class="attraction-modal-body">
                <div class="attraction-detail-section">
                    <h3>üìç Location Details</h3>
                    <p id="modal-attraction-distance"></p>
                </div>
                <div class="attraction-detail-section">
                    <h3>üìñ Description</h3>
                    <p id="modal-attraction-description"></p>
                </div>
                <div class="attraction-meta" id="modal-attraction-meta">
                    <!-- Meta information will be added here -->
                </div>
                <div id="modal-wikipedia-section"></div>
            </div>
        </div>
    </div>

    <!-- Itinerary Modal -->
    <div id="itinerary-modal" class="itinerary-modal">
        <div class="itinerary-content">
            <div class="itinerary-header">
                <h2 class="itinerary-title">‚úàÔ∏è My Travel Plan for <span id="trip-location"></span></h2>
                <button class="close-modal" onclick="closeItineraryModal()">√ó</button>
            </div>
            
            <div class="trip-days" id="trip-days">
                <!-- Days will be added here dynamically -->
            </div>
            
            <button class="add-day-btn" onclick="addDay()">+ Add Another Day</button>
            
            <div class="itinerary-actions-bottom">
                <button class="export-btn" onclick="exportItinerary()">üìÑ Export as PDF</button>
                <button class="save-btn" onclick="saveItinerary()">üíæ Save Itinerary</button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">
                    <svg class="logo-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 18v-6a9 9 0 0 1 18 0v6"></path>
                        <path d="M21 19a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3zM3 19a2 2 0 0 0 2 2h1a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2H3z"></path>
                    </svg>
                    <span>VOYAGER</span>
                </div>
                <p class="footer-text">¬© 2025 Voyager. Crafting extraordinary travel experiences.</p>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/appwrite@16.0.2"></script>
    <script src="auth.js"></script>
    <script src="script.js"></script>
    <script src="api-services-proxy.js"></script>
    <script>
        // Trip Planner Search Functionality - SIMPLIFIED AND WORKING
        
        // Handle Enter key in search input
        function handleSearchKeypress(event) {
            if (event.key === 'Enter') {
                searchLocation();
            }
        }

        // Quick search buttons
        function quickSearch(location) {
            document.getElementById('location-search').value = location;
            searchLocation();
        }

        // Main search function - FIXED VERSION
        async function searchLocation() {
            const searchInput = document.getElementById('location-search');
            const searchBtn = document.getElementById('search-btn');
            const loadingState = document.getElementById('loading-state');
            const resultsSection = document.getElementById('results-section');
            const noResults = document.getElementById('no-results');

            const query = searchInput.value.trim();
            
            if (!query) {
                alert('Please enter a location to search');
                return;
            }

            console.log('üîç Searching for:', query);

            // Show loading state
            searchBtn.disabled = true;
            searchBtn.textContent = 'Searching...';
            loadingState.style.display = 'block';
            resultsSection.style.display = 'none';
            resultsSection.classList.remove('active');
            noResults.style.display = 'none';

            try {
                console.log('üì∏ Fetching photos...');
                // Fetch photos with timeout
                const photosPromise = fetchLocationPhotos(query);
                const photos = await Promise.race([
                    photosPromise,
                    new Promise((_, reject) => setTimeout(() => reject(new Error('Photos timeout')), 5000))
                ]).catch(err => {
                    console.warn('Photos failed, using placeholders:', err);
                    return generatePlaceholderPhotos(query);
                });

                console.log('üì∏ Photos received:', photos.length);
                
                console.log('üèõÔ∏è Fetching attractions...');
                // Fetch attractions with longer timeout for Overpass API
                const attractionsPromise = fetchLocationAttractions(query);
                const attractions = await Promise.race([
                    attractionsPromise,
                    new Promise((_, reject) => setTimeout(() => reject(new Error('Attractions timeout')), 15000))
                ]).catch(err => {
                    console.error('‚ùå Attractions failed:', err);
                    console.warn('‚ö†Ô∏è Falling back to sample data');
                    return generateSampleAttractions(query);
                });

                console.log('üèõÔ∏è Attractions received:', attractions.length);
                console.log('üèõÔ∏è First attraction:', attractions[0]);

                // Set current location for itinerary
                currentLocation = query;
                
                // Apply location-specific color palette
                applyColorPalette(query);
                
                // Reset selections when searching new location
                selectedAttractions = [];
                
                // Fetch images for attractions
                const attractionsWithImages = await fetchImagesForAttractions(attractions, query);
                
                // Always display results even if we have placeholders
                displayLocationInfo(query, photos.length, attractionsWithImages.length);
                displayPhotos(photos);
                displayAttractions(attractionsWithImages);

                // Show results
                loadingState.style.display = 'none';
                resultsSection.style.display = 'block';
                resultsSection.classList.add('active');
                
                console.log('‚úÖ Search completed successfully!');
                
            } catch (error) {
                console.error('‚ùå Search error:', error);
                alert('Error loading results. Showing sample data instead.');
                
                // Show sample data anyway
                const photos = generatePlaceholderPhotos(query);
                const attractions = generateSampleAttractions(query);
                
                displayLocationInfo(query, photos.length, attractions.length);
                displayPhotos(photos);
                displayAttractions(attractions);
                
                loadingState.style.display = 'none';
                resultsSection.style.display = 'block';
                resultsSection.classList.add('active');
            } finally {
                searchBtn.disabled = false;
                searchBtn.textContent = 'Search';
            }
        }

        // Fetch photos - SIMPLIFIED
        async function fetchLocationPhotos(location) {
            console.log('üì∏ Fetching photos for:', location);
            
            try {
                // Try API proxy first if available
                const response = await fetch(`http://localhost:3001/api/images?q=${encodeURIComponent(location)}&per_page=9`);
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('‚úÖ Photos from API:', data);
                    
                    if (data.photos && data.photos.length > 0) {
                        return data.photos.map(photo => ({
                            url: photo.url || photo.src.large,
                            thumbnail: photo.src.medium || photo.src.small,
                            title: photo.alt || `${location} view`,
                            photographer: photo.photographer || 'Unknown',
                            photographerUrl: photo.photographer_url || '#'
                        }));
                    }
                }
            } catch (error) {
                console.log('‚ö†Ô∏è API proxy not available, using Unsplash direct URLs');
            }
            
            // Fallback to direct Unsplash URLs (always works, no API key needed)
            return generatePlaceholderPhotos(location);
        }

        // Generate photos with multiple reliable sources
        function generatePlaceholderPhotos(location) {
            console.log('üì∏ Generating photos for:', location);
            const photos = [];
            
            // Curated travel photo collections from various sources
            const photoSources = [
                // Using reliable CDN images
                { url: 'https://images.unsplash.com/photo-1493976040374-85c8e12f0c0e?w=800&h=600&fit=crop', thumb: 'https://images.unsplash.com/photo-1493976040374-85c8e12f0c0e?w=400&h=300&fit=crop', title: 'City Skyline' },
                { url: 'https://images.unsplash.com/photo-1502920917128-1aa500764cbd?w=800&h=600&fit=crop', thumb: 'https://images.unsplash.com/photo-1502920917128-1aa500764cbd?w=400&h=300&fit=crop', title: 'Historic Monument' },
                { url: 'https://images.unsplash.com/photo-1469854523086-cc02fe5d8800?w=800&h=600&fit=crop', thumb: 'https://images.unsplash.com/photo-1469854523086-cc02fe5d8800?w=400&h=300&fit=crop', title: 'Scenic Landscape' },
                { url: 'https://images.unsplash.com/photo-1488646953014-85cb44e25828?w=800&h=600&fit=crop', thumb: 'https://images.unsplash.com/photo-1488646953014-85cb44e25828?w=400&h=300&fit=crop', title: 'Beautiful Architecture' },
                { url: 'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=800&h=600&fit=crop', thumb: 'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=400&h=300&fit=crop', title: 'Mountain View' },
                { url: 'https://images.unsplash.com/photo-1476514525535-07fb3b4ae5f1?w=800&h=600&fit=crop', thumb: 'https://images.unsplash.com/photo-1476514525535-07fb3b4ae5f1?w=400&h=300&fit=crop', title: 'Lake Scenery' },
                { url: 'https://images.unsplash.com/photo-1504893524553-b855bce32c67?w=800&h=600&fit=crop', thumb: 'https://images.unsplash.com/photo-1504893524553-b855bce32c67?w=400&h=300&fit=crop', title: 'Natural Wonder' },
                { url: 'https://images.unsplash.com/photo-1530789253388-582c481c54b0?w=800&h=600&fit=crop', thumb: 'https://images.unsplash.com/photo-1530789253388-582c481c54b0?w=400&h=300&fit=crop', title: 'Urban Scene' },
                { url: 'https://images.unsplash.com/photo-1501594907352-04cda38ebc29?w=800&h=600&fit=crop', thumb: 'https://images.unsplash.com/photo-1501594907352-04cda38ebc29?w=400&h=300&fit=crop', title: 'Coastal Beauty' }
            ];
            
            // Use the curated photos
            for (let i = 0; i < 9; i++) {
                const source = photoSources[i % photoSources.length];
                photos.push({
                    url: source.url,
                    thumbnail: source.thumb,
                    title: `${location} - ${source.title}`,
                    photographer: 'Travel Photography',
                    photographerUrl: 'https://unsplash.com'
                });
            }
            
            console.log(`‚úÖ Generated ${photos.length} photo URLs for ${location}`);
            return photos;
        }

        // Fetch REAL attractions using Overpass API (OpenStreetMap) - FREE & NO API KEY NEEDED
        async function fetchLocationAttractions(location) {
            console.log('üîç Fetching REAL attractions for:', location);
            
            try {
                // Step 1: Smart location detection with autocorrect
                const correctedLocation = await smartLocationDetection(location);
                console.log('üìç Corrected location:', correctedLocation);
                
                // Step 2: Geocode the location to get coordinates
                const geocodeResponse = await fetch(`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(correctedLocation)}&format=json&limit=1&accept-language=en`, {
                    headers: {
                        'User-Agent': 'TravelWebsite/1.0'
                    }
                });
                
                const geocodeData = await geocodeResponse.json();
                console.log('üìç Geocode response:', geocodeData);
                
                if (!geocodeData || geocodeData.length === 0) {
                    console.warn('‚ö†Ô∏è Location not found, trying alternatives...');
                    return await tryAlternativeLocationSearch(location);
                }
                
                const lat = parseFloat(geocodeData[0].lat);
                const lon = parseFloat(geocodeData[0].lon);
                const displayName = geocodeData[0].display_name;
                console.log(`‚úÖ Found coordinates: ${lat}, ${lon} (${displayName})`);
                
                // Step 3: Fetch REAL attractions from OpenStreetMap using Overpass API
                const attractions = await fetchRealAttractionsFromOSM(lat, lon, correctedLocation);
                
                if (attractions.length > 0) {
                    console.log(`‚úÖ Successfully fetched ${attractions.length} REAL attractions from OpenStreetMap!`);
                    return attractions;
                }
                
                console.warn('‚ö†Ô∏è No attractions found in OSM, trying fallback...');
                return generateSampleAttractions(correctedLocation);
                
            } catch (error) {
                console.error('‚ùå Error fetching attractions:', error);
                return generateSampleAttractions(location);
            }
        }

        // Smart location detection with autocorrect
        async function smartLocationDetection(input) {
            const cleaned = input.trim().toLowerCase();
            
            // Common misspellings and corrections
            const corrections = {
                'tokio': 'tokyo',
                'parris': 'paris',
                'london': 'london',
                'new yourk': 'new york',
                'rome': 'rome',
                'barselona': 'barcelona',
                'dubai': 'dubai',
                'singapoor': 'singapore',
                'bangkkok': 'bangkok',
                'istanbul': 'istanbul',
                'mumbai': 'mumbai',
                'dilli': 'delhi',
                'bejing': 'beijing',
                'shangai': 'shanghai',
                'sydny': 'sydney',
                'melborne': 'melbourne',
                'amsterdm': 'amsterdam',
                'berlin': 'berlin',
                'madrid': 'madrid',
                'lisbon': 'lisbon',
                'prague': 'prague',
                'vienna': 'vienna',
                'budapest': 'budapest',
                'moscow': 'moscow',
                'rio': 'rio de janeiro',
                'sao paulo': 'sao paulo',
                'buenos aires': 'buenos aires',
                'cairo': 'cairo',
                'capetown': 'cape town',
                'marrakech': 'marrakech'
            };
            
            // Apply corrections
            return corrections[cleaned] || input;
        }

        // Try alternative location searches
        async function tryAlternativeLocationSearch(location) {
            console.log('üîÑ Trying alternative searches for:', location);
            
            const alternatives = [
                `${location} city`,
                `${location} tourism`,
                `${location} travel`,
                location.split(' ')[0] // First word only
            ];
            
            for (const alt of alternatives) {
                try {
                    const response = await fetch(`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(alt)}&format=json&limit=1`, {
                        headers: { 'User-Agent': 'TravelWebsite/1.0' }
                    });
                    const data = await response.json();
                    if (data && data.length > 0) {
                        console.log(`‚úÖ Found location with: ${alt}`);
                        const lat = parseFloat(data[0].lat);
                        const lon = parseFloat(data[0].lon);
                        return await fetchRealAttractionsFromOSM(lat, lon, location);
                    }
                } catch (error) {
                    console.log(`‚ö†Ô∏è Alternative search failed for: ${alt}`);
                }
            }
            
            return generateSampleAttractions(location);
        }

        // Fetch REAL attractions from OpenStreetMap using Overpass API
        async function fetchRealAttractionsFromOSM(lat, lon, locationName) {
            console.log(`üó∫Ô∏è ========================================`);
            console.log(`üó∫Ô∏è Querying OpenStreetMap Overpass API`);
            console.log(`üó∫Ô∏è Location: ${locationName}`);
            console.log(`üó∫Ô∏è Coordinates: ${lat}, ${lon}`);
            console.log(`üó∫Ô∏è ========================================`);
            
            try {
                // Overpass API query for tourist attractions within 5km radius
                const radius = 5000; // 5km
                const overpassQuery = `
                    [out:json][timeout:25];
                    (
                        node["tourism"~"museum|attraction|viewpoint|gallery|artwork|theme_park|zoo"](around:${radius},${lat},${lon});
                        node["historic"~"monument|castle|ruins|memorial|archaeological_site"](around:${radius},${lat},${lon});
                        node["amenity"="place_of_worship"](around:${radius},${lat},${lon});
                        way["tourism"~"museum|attraction|viewpoint|gallery|theme_park|zoo"](around:${radius},${lat},${lon});
                        way["historic"~"monument|castle|ruins|memorial"](around:${radius},${lat},${lon});
                        way["leisure"~"park|garden"](around:${radius},${lat},${lon});
                    );
                    out center 30;
                `;
                
                console.log('üì§ Sending query to Overpass API...');
                
                const overpassUrl = 'https://overpass-api.de/api/interpreter';
                const response = await fetch(overpassUrl, {
                    method: 'POST',
                    body: 'data=' + encodeURIComponent(overpassQuery),
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    }
                });
                
                console.log(`üì• Response status: ${response.status} ${response.statusText}`);
                
                if (!response.ok) {
                    throw new Error(`Overpass API error: ${response.status}`);
                }
                
                const data = await response.json();
                console.log(`üìä Overpass API returned ${data.elements?.length || 0} total elements`);
                
                if (data.elements && data.elements.length > 0) {
                    const withNames = data.elements.filter(e => e.tags && e.tags.name);
                    console.log(`üìã Elements with names: ${withNames.length}`);
                    console.log(`üìã Sample attractions:`, withNames.slice(0, 5).map(e => e.tags.name));
                } else {
                    console.log(`‚ö†Ô∏è No elements returned from Overpass API`);
                }
                
                if (!data.elements || data.elements.length === 0) {
                    console.warn('‚ö†Ô∏è No attractions found in OpenStreetMap data');
                    return [];
                }
                
                // Process and format the attractions
                const attractions = data.elements
                    .filter(element => element.tags && element.tags.name) // Only elements with names
                    .slice(0, 12) // Get top 12
                    .map(element => {
                        const tags = element.tags;
                        const elementLat = element.lat || element.center?.lat || lat;
                        const elementLon = element.lon || element.center?.lon || lon;
                        
                        // Calculate distance from search center
                        const distance = calculateDistance(lat, lon, elementLat, elementLon);
                        
                        // Determine type
                        let type = 'Attraction';
                        if (tags.tourism) type = tags.tourism.charAt(0).toUpperCase() + tags.tourism.slice(1);
                        else if (tags.historic) type = 'Historic ' + tags.historic.charAt(0).toUpperCase() + tags.historic.slice(1);
                        else if (tags.leisure) type = tags.leisure.charAt(0).toUpperCase() + tags.leisure.slice(1);
                        else if (tags.amenity === 'place_of_worship') type = 'Religious Site';
                        
                        // Create description
                        let description = `A notable ${type.toLowerCase()} in ${locationName}.`;
                        if (tags.description) {
                            description = tags.description.substring(0, 200);
                        } else if (tags.wikipedia) {
                            description = `Historic landmark with Wikipedia entry. ${distance} from city center.`;
                        } else if (tags['tourism:description']) {
                            description = tags['tourism:description'].substring(0, 200);
                        }
                        
                        return {
                            name: tags.name,
                            type: type.replace(/_/g, ' '),
                            description: description,
                            distance: `${distance.toFixed(1)} km from center`,
                            realLocation: true,
                            coordinates: { lat: elementLat, lon: elementLon },
                            tags: tags
                        };
                    });
                
                console.log(`‚úÖ Processed ${attractions.length} REAL attractions from OSM`);
                return attractions;
                
            } catch (error) {
                console.error('‚ùå Error fetching from Overpass API:', error);
                return [];
            }
        }

        // Calculate distance between two coordinates (Haversine formula)
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; // Earth's radius in km
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                     Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                     Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        // Fetch HIGH QUALITY images for attractions with BETTER ERROR HANDLING
        async function fetchImagesForAttractions(attractions, location) {
            console.log('üñºÔ∏è Fetching HIGH QUALITY images for attractions...');
            
            const attractionsWithImages = await Promise.all(
                attractions.map(async (attraction, index) => {
                    // Add delay to avoid rate limiting
                    await new Promise(resolve => setTimeout(resolve, index * 100));
                    
                    try {
                        // Strategy 1: Try exact attraction name + location
                        let searchQuery = `${attraction.name} ${location}`;
                        let response = await fetch(`http://localhost:3001/api/images?q=${encodeURIComponent(searchQuery)}&per_page=5&orientation=landscape`);
                        
                        if (response.ok) {
                            const data = await response.json();
                            if (data.photos && data.photos.length > 0) {
                                const photo = data.photos[0];
                                console.log(`‚úÖ Found HD image for: ${attraction.name}`);
                                return {
                                    ...attraction,
                                    image: photo.src.large2x || photo.src.large || photo.url,
                                    imageThumb: photo.src.large || photo.src.medium,
                                    photographer: photo.photographer,
                                    imageUrl: photo.url
                                };
                            }
                        }
                        
                        // Strategy 2: Try just the attraction name
                        searchQuery = attraction.name;
                        response = await fetch(`http://localhost:3001/api/images?q=${encodeURIComponent(searchQuery)}&per_page=5&orientation=landscape`);
                        
                        if (response.ok) {
                            const data = await response.json();
                            if (data.photos && data.photos.length > 0) {
                                const photo = data.photos[0];
                                console.log(`‚úÖ Found HD image for: ${attraction.name} (name only)`);
                                return {
                                    ...attraction,
                                    image: photo.src.large2x || photo.src.large || photo.url,
                                    imageThumb: photo.src.large || photo.src.medium,
                                    photographer: photo.photographer,
                                    imageUrl: photo.url
                                };
                            }
                        }
                        
                        // Strategy 3: Try by type and location with more specific keywords
                        searchQuery = `${location} ${attraction.type} landmark architecture`;
                        response = await fetch(`http://localhost:3001/api/images?q=${encodeURIComponent(searchQuery)}&per_page=5&orientation=landscape`);
                        
                        if (response.ok) {
                            const data = await response.json();
                            if (data.photos && data.photos.length > 0) {
                                const photo = data.photos[index % data.photos.length];
                                console.log(`‚úÖ Found HD image by type for: ${attraction.name}`);
                                return {
                                    ...attraction,
                                    image: photo.src.large2x || photo.src.large || photo.url,
                                    imageThumb: photo.src.large || photo.src.medium,
                                    photographer: photo.photographer,
                                    imageUrl: photo.url
                                };
                            }
                        }
                        
                    } catch (error) {
                        console.warn(`‚ö†Ô∏è Failed to fetch image for ${attraction.name}:`, error);
                    }
                    
                    // Fallback: Use enhanced location-specific Unsplash images
                    const categories = ['landmark', 'cityscape', 'tourist-attraction', 'architecture', 'aerial-view', 'monument'];
                    const category = categories[index % categories.length];
                    const fallbackQuery = `${location},${category}`;
                    console.log(`‚ö†Ô∏è Using fallback HD image for: ${attraction.name} with query: ${fallbackQuery}`);
                    
                    return {
                        ...attraction,
                        image: `https://source.unsplash.com/1600x1200/?${fallbackQuery},${index}`,
                        imageThumb: `https://source.unsplash.com/800x600/?${fallbackQuery},${index}`,
                        photographer: 'Unsplash',
                        imageUrl: null
                    };
                })
            );
            
            console.log('‚úÖ All HIGH QUALITY images fetched successfully!');
            return attractionsWithImages;
        }

        // Generate sample attractions
        function generateSampleAttractions(location) {
            console.log('Generating sample attractions for:', location);
            const types = ['Museum', 'Park', 'Restaurant', 'Monument', 'Beach', 'Temple', 'Market', 'Palace'];
            const attractions = [];
            
            for (let i = 0; i < 6; i++) {
                attractions.push({
                    name: `Popular ${types[i]} in ${location}`,
                    type: types[i],
                    description: `A wonderful ${types[i].toLowerCase()} to visit in ${location}. Experience the local culture and beauty of this amazing destination.`,
                    distance: `${(Math.random() * 5 + 0.5).toFixed(1)} km from center`
                });
            }
            
            return attractions;
        }

        // Display location info
        function displayLocationInfo(location, photoCount, attractionCount) {
            const locationInfo = document.getElementById('location-info');
            locationInfo.innerHTML = `
                <div class="location-header">
                    <div>
                        <h2 class="location-name">${location}</h2>
                        <p class="location-country">Discover the beauty and culture</p>
                    </div>
                </div>
                <div class="location-stats">
                    <div class="stat-item">
                        <div class="stat-value">${photoCount}</div>
                        <div class="stat-label">Photos</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">${attractionCount}</div>
                        <div class="stat-label">Attractions</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">‚≠ê</div>
                        <div class="stat-label">Popular Destination</div>
                    </div>
                </div>
            `;
        }

        // Display photos with Save to Gallery button
        function displayPhotos(photos) {
            const photosGrid = document.getElementById('photos-grid');
            photosGrid.innerHTML = photos.map((photo, index) => `
                <div class="photo-card">
                    <img src="${photo.thumbnail}" alt="${photo.title}" loading="lazy" onerror="this.src='https://via.placeholder.com/400x300?text=Image+Not+Available'">
                    <div class="photo-overlay">
                        <div class="photo-title">${photo.title}</div>
                        <div class="photo-photographer">by ${photo.photographer}</div>
                    </div>
                </div>
            `).join('');
        }


        // Store selected attractions and current location
        let selectedAttractions = [];
        let currentLocation = '';
        let itineraryDays = [[]]; // Start with one empty day
        let currentColorPalette = {};
        
        // Location-based color palettes
        const locationColorPalettes = {
            // Asian cities - vibrant and traditional
            'tokyo': { primary: '#E63946', secondary: '#F1FAEE', accent: '#A8DADC', dark: '#1D3557', light: '#FFB4A2' },
            'kyoto': { primary: '#D62828', secondary: '#F77F00', accent: '#FCBF49', dark: '#003049', light: '#EAE2B7' },
            'bangkok': { primary: '#FFB700', secondary: '#FF6B35', accent: '#F7931E', dark: '#004E89', light: '#FFEAA7' },
            'singapore': { primary: '#06BEE1', secondary: '#FF6B6B', accent: '#4ECDC4', dark: '#1A535C', light: '#FFE66D' },
            'mumbai': { primary: '#FF6F00', secondary: '#FFC107', accent: '#FF9800', dark: '#BF360C', light: '#FFD54F' },
            'delhi': { primary: '#F44336', secondary: '#FF9800', accent: '#FFEB3B', dark: '#5D4037', light: '#FFF9C4' },
            'seoul': { primary: '#9C27B0', secondary: '#E91E63', accent: '#FF4081', dark: '#4A148C', light: '#F8BBD0' },
            'beijing': { primary: '#D32F2F', secondary: '#FBC02D', accent: '#F57C00', dark: '#B71C1C', light: '#FFF176' },
            'shanghai': { primary: '#1976D2', secondary: '#FFC107', accent: '#00BCD4', dark: '#0D47A1', light: '#81D4FA' },
            
            // European cities - elegant and historic
            'paris': { primary: '#E91E63', secondary: '#9C27B0', accent: '#FFD700', dark: '#4A148C', light: '#F8BBD0' },
            'london': { primary: '#B71C1C', secondary: '#1565C0', accent: '#FFD700', dark: '#263238', light: '#90CAF9' },
            'rome': { primary: '#F57C00', secondary: '#5D4037', accent: '#FFD54F', dark: '#3E2723', light: '#FFE082' },
            'barcelona': { primary: '#D84315', secondary: '#FBC02D', accent: '#7B1FA2', dark: '#BF360C', light: '#FFF59D' },
            'amsterdam': { primary: '#1976D2', secondary: '#FF6F00', accent: '#FBC02D', dark: '#0D47A1', light: '#FFB74D' },
            'berlin': { primary: '#424242', secondary: '#FFC107', accent: '#D32F2F', dark: '#212121', light: '#FFF176' },
            'vienna': { primary: '#6A1B9A', secondary: '#FFD700', accent: '#E91E63', dark: '#4A148C', light: '#F8BBD0' },
            'prague': { primary: '#5D4037', secondary: '#FFC107', accent: '#D32F2F', dark: '#3E2723', light: '#FFE082' },
            
            // American cities - modern and bold
            'new york': { primary: '#212121', secondary: '#FFD700', accent: '#1976D2', dark: '#000000', light: '#FDD835' },
            'los angeles': { primary: '#FF6F00', secondary: '#FFC107', accent: '#00BCD4', dark: '#E65100', light: '#FFD54F' },
            'san francisco': { primary: '#D84315', secondary: '#FFD700', accent: '#00BCD4', dark: '#BF360C', light: '#80DEEA' },
            'miami': { primary: '#00BCD4', secondary: '#FF6F00', accent: '#E91E63', dark: '#006064', light: '#FFB74D' },
            'chicago': { primary: '#1565C0', secondary: '#D32F2F', accent: '#FFC107', dark: '#0D47A1', light: '#FFF176' },
            
            // Middle Eastern cities - rich and warm
            'dubai': { primary: '#FFD700', secondary: '#D84315', accent: '#1976D2', dark: '#BF360C', light: '#FFE082' },
            'istanbul': { primary: '#E91E63', secondary: '#1976D2', accent: '#FFD700', dark: '#880E4F', light: '#90CAF9' },
            'cairo': { primary: '#F57C00', secondary: '#5D4037', accent: '#FFD700', dark: '#E65100', light: '#FFE082' },
            
            // Default - purple theme
            'default': { primary: '#9D4EDD', secondary: '#7209B7', accent: '#F72585', dark: '#3C096C', light: '#E0AAFF' }
        };
        
        // Get color palette for location
        function getLocationColorPalette(location) {
            const normalized = location.toLowerCase().trim();
            
            // Check exact matches
            if (locationColorPalettes[normalized]) {
                return locationColorPalettes[normalized];
            }
            
            // Check partial matches
            for (const [city, palette] of Object.entries(locationColorPalettes)) {
                if (normalized.includes(city) || city.includes(normalized)) {
                    return palette;
                }
            }
            
            // Return default
            return locationColorPalettes['default'];
        }
        
        // Apply color palette to page
        function applyColorPalette(location) {
            const palette = getLocationColorPalette(location);
            currentColorPalette = palette;
            
            console.log('üé® Applying color palette for:', location, palette);
            
            // Update CSS variables
            document.documentElement.style.setProperty('--primary-purple', palette.primary);
            document.documentElement.style.setProperty('--secondary-purple', palette.secondary);
            document.documentElement.style.setProperty('--accent-pink', palette.accent);
            document.documentElement.style.setProperty('--bg-glass', `${palette.primary}14`); // 8% opacity
            document.documentElement.style.setProperty('--bg-glass-hover', `${palette.primary}26`); // 15% opacity
            document.documentElement.style.setProperty('--border-color', `${palette.primary}33`); // 20% opacity
            document.documentElement.style.setProperty('--border-glow', `${palette.primary}66`); // 40% opacity
            
            // Add transition effect
            document.body.style.transition = 'background-color 0.5s ease';
        }

        // Display attractions with checkboxes and HD liquid glass images
        function displayAttractions(attractions) {
            const attractionsGrid = document.getElementById('attractions-grid');
            attractionsGrid.innerHTML = attractions.map((attraction, index) => `
                <div class="attraction-card" id="attraction-${index}">
                    <div class="attraction-image-wrapper">
                        <img src="${attraction.imageThumb || attraction.image}" 
                             alt="${attraction.name}" 
                             class="attraction-image"
                             loading="lazy"
                             onerror="this.src='https://images.unsplash.com/photo-1488646953014-85cb44e25828?w=800&q=80'">
                        <div class="liquid-glass-overlay"></div>
                        <div class="attraction-image-credit">üì∑ ${attraction.photographer || 'Unknown'}</div>
                        <input type="checkbox" class="attraction-select" id="select-${index}" onclick="toggleAttractionCheckbox(${index}, event)">
                    </div>
                    <div class="attraction-content">
                        <h3 class="attraction-name">${attraction.name}</h3>
                        <span class="attraction-type">${attraction.type}</span>
                        <div class="attraction-info">${attraction.description}</div>
                        <div class="attraction-distance">
                            üìç ${attraction.distance}
                        </div>
                        <div class="attraction-actions">
                            <button class="learn-more-btn" onclick="openAttractionDetails(${index}); event.stopPropagation();">
                                üìö Learn More
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
            
            // Store attractions globally
            window.allAttractions = attractions;
        }

        // Toggle attraction checkbox
        function toggleAttractionCheckbox(index, event) {
            event.stopPropagation();
            const card = document.getElementById(`attraction-${index}`);
            const checkbox = document.getElementById(`select-${index}`);
            
            const attraction = window.allAttractions[index];
            
            if (checkbox.checked) {
                card.classList.add('selected');
                selectedAttractions.push({...attraction, index});
            } else {
                card.classList.remove('selected');
                selectedAttractions = selectedAttractions.filter(a => a.index !== index);
            }
            
            updateSelectedCount();
        }

        // Open attraction details modal with Wikipedia data
        async function openAttractionDetails(index) {
            const attraction = window.allAttractions[index];
            
            // Set basic info
            document.getElementById('modal-attraction-name').textContent = attraction.name;
            document.getElementById('modal-attraction-type').textContent = attraction.type;
            document.getElementById('modal-attraction-distance').textContent = attraction.distance;
            document.getElementById('modal-attraction-description').textContent = attraction.description;
            
            // Show modal immediately
            document.getElementById('attraction-modal').classList.add('active');
            
            // Fetch Wikipedia data
            await fetchWikipediaData(attraction);
        }

        // Close attraction modal
        function closeAttractionModal() {
            document.getElementById('attraction-modal').classList.remove('active');
        }

        // Fetch Wikipedia data for attraction
        async function fetchWikipediaData(attraction) {
            console.log('üîç Fetching Wikipedia data for:', attraction.name);
            
            const wikipediaSection = document.getElementById('modal-wikipedia-section');
            wikipediaSection.innerHTML = '<p style="color: var(--text-secondary); text-align: center;">Loading Wikipedia information...</p>';
            
            try {
                // Search Wikipedia
                const searchUrl = `https://en.wikipedia.org/w/api.php?action=query&list=search&srsearch=${encodeURIComponent(attraction.name)}&format=json&origin=*`;
                const searchResponse = await fetch(searchUrl);
                const searchData = await searchResponse.json();
                
                if (!searchData.query?.search || searchData.query.search.length === 0) {
                    wikipediaSection.innerHTML = '<p style="color: var(--text-secondary);">No Wikipedia article found for this attraction.</p>';
                    return;
                }
                
                const pageTitle = searchData.query.search[0].title;
                const pageId = searchData.query.search[0].pageid;
                
                // Get full article extract
                const extractUrl = `https://en.wikipedia.org/w/api.php?action=query&prop=extracts|info&exintro&explaintext&inprop=url&pageids=${pageId}&format=json&origin=*`;
                const extractResponse = await fetch(extractUrl);
                const extractData = await extractResponse.json();
                
                const page = extractData.query.pages[pageId];
                const extract = page.extract;
                const url = page.fullurl;
                
                // Display Wikipedia info
                if (extract) {
                    const shortExtract = extract.substring(0, 500) + (extract.length > 500 ? '...' : '');
                    
                    wikipediaSection.innerHTML = `
                        <div class="attraction-detail-section">
                            <h3>üìö From Wikipedia</h3>
                            <p>${shortExtract}</p>
                            <a href="${url}" target="_blank" class="wikipedia-link">
                                üìñ Read Full Article on Wikipedia
                            </a>
                        </div>
                    `;
                    
                    console.log('‚úÖ Wikipedia data loaded successfully');
                } else {
                    wikipediaSection.innerHTML = '<p style="color: var(--text-secondary);">Wikipedia information not available.</p>';
                }
                
                // Add meta information
                const metaHtml = `
                    <div class="meta-item">
                        <div class="meta-label">Category</div>
                        <div class="meta-value">${attraction.type}</div>
                    </div>
                    <div class="meta-item">
                        <div class="meta-label">Distance</div>
                        <div class="meta-value">${attraction.distance}</div>
                    </div>
                    <div class="meta-item">
                        <div class="meta-label">Source</div>
                        <div class="meta-value">OpenStreetMap</div>
                    </div>
                `;
                document.getElementById('modal-attraction-meta').innerHTML = metaHtml;
                
            } catch (error) {
                console.error('‚ùå Error fetching Wikipedia data:', error);
                wikipediaSection.innerHTML = '<p style="color: var(--text-secondary);">Failed to load Wikipedia information.</p>';
            }
        }


        // Update selected count display
        function updateSelectedCount() {
            const count = selectedAttractions.length;
            document.getElementById('selected-count').textContent = count;
            
            const actionsBar = document.getElementById('itinerary-actions');
            if (count > 0) {
                actionsBar.classList.add('visible');
            } else {
                actionsBar.classList.remove('visible');
            }
        }

        // Open itinerary modal
        function openItineraryModal() {
            if (selectedAttractions.length === 0) {
                alert('Please select at least one attraction first!');
                return;
            }
            
            document.getElementById('trip-location').textContent = currentLocation;
            
            // Reset itinerary
            itineraryDays = [[]];
            
            // Distribute attractions across days (max 3 per day)
            const attractionsPerDay = 3;
            selectedAttractions.forEach((attraction, index) => {
                const dayIndex = Math.floor(index / attractionsPerDay);
                if (!itineraryDays[dayIndex]) {
                    itineraryDays[dayIndex] = [];
                }
                itineraryDays[dayIndex].push(attraction);
            });
            
            renderItinerary();
            document.getElementById('itinerary-modal').classList.add('active');
        }

        // Close itinerary modal
        function closeItineraryModal() {
            document.getElementById('itinerary-modal').classList.remove('active');
        }

        // Render itinerary
        function renderItinerary() {
            const tripDaysContainer = document.getElementById('trip-days');
            tripDaysContainer.innerHTML = itineraryDays.map((day, dayIndex) => `
                <div class="day-section" id="day-${dayIndex}">
                    <div class="day-header">
                        <h3 class="day-title">üìÖ Day ${dayIndex + 1}</h3>
                        <span style="color: var(--text-secondary); font-size: 0.9rem;">${day.length} places</span>
                    </div>
                    <div class="day-places" id="places-day-${dayIndex}">
                        ${day.length === 0 ? '<p style="color: var(--text-secondary); text-align: center; padding: 1rem;">No places added yet. Drag attractions here or move them from other days.</p>' : 
                        day.map((place, placeIndex) => `
                            <div class="itinerary-place">
                                <div class="place-info">
                                    <h4>${place.name}</h4>
                                    <p>${place.type} ‚Ä¢ ${place.distance}</p>
                                </div>
                                <div class="place-actions">
                                    ${dayIndex > 0 ? `<button class="move-btn" onclick="movePlace(${dayIndex}, ${placeIndex}, -1)">‚Üë Prev Day</button>` : ''}
                                    ${dayIndex < itineraryDays.length - 1 ? `<button class="move-btn" onclick="movePlace(${dayIndex}, ${placeIndex}, 1)">‚Üì Next Day</button>` : ''}
                                    <button class="remove-btn" onclick="removePlace(${dayIndex}, ${placeIndex})">üóëÔ∏è</button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }

        // Add a new day
        function addDay() {
            itineraryDays.push([]);
            renderItinerary();
        }

        // Move place between days
        function movePlace(fromDay, placeIndex, direction) {
            const toDay = fromDay + direction;
            if (toDay < 0 || toDay >= itineraryDays.length) return;
            
            const place = itineraryDays[fromDay][placeIndex];
            itineraryDays[fromDay].splice(placeIndex, 1);
            itineraryDays[toDay].push(place);
            
            renderItinerary();
        }

        // Remove place from itinerary
        function removePlace(dayIndex, placeIndex) {
            itineraryDays[dayIndex].splice(placeIndex, 1);
            renderItinerary();
        }

        // Export itinerary as text/PDF
        function exportItinerary() {
            let itineraryText = `TRAVEL PLAN FOR ${currentLocation.toUpperCase()}\n`;
            itineraryText += `Generated on ${new Date().toLocaleDateString()}\n`;
            itineraryText += `${'='.repeat(50)}\n\n`;
            
            itineraryDays.forEach((day, dayIndex) => {
                if (day.length > 0) {
                    itineraryText += `DAY ${dayIndex + 1}\n`;
                    itineraryText += `${'-'.repeat(30)}\n`;
                    day.forEach((place, index) => {
                        itineraryText += `${index + 1}. ${place.name}\n`;
                        itineraryText += `   Type: ${place.type}\n`;
                        itineraryText += `   Location: ${place.distance}\n`;
                        itineraryText += `   Info: ${place.description}\n\n`;
                    });
                    itineraryText += '\n';
                }
            });
            
            // Create downloadable file
            const blob = new Blob([itineraryText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${currentLocation.replace(/\s+/g, '_')}_Travel_Plan.txt`;
            a.click();
            URL.revokeObjectURL(url);
            
            alert('‚úÖ Itinerary exported successfully!');
        }

        // Save itinerary to localStorage
        function saveItinerary() {
            const itinerary = {
                location: currentLocation,
                date: new Date().toISOString(),
                days: itineraryDays,
                attractions: selectedAttractions
            };
            
            const savedItineraries = JSON.parse(localStorage.getItem('savedItineraries') || '[]');
            savedItineraries.push(itinerary);
            localStorage.setItem('savedItineraries', JSON.stringify(savedItineraries));
            
            alert('‚úÖ Itinerary saved successfully! You can view it anytime.');
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            const searchInput = document.getElementById('location-search');
            if (searchInput) {
                searchInput.focus();
            }
            console.log('‚úÖ Trip Planner Ready!');
        });
    </script>

    <!-- Chaos Mode Script -->
    <script src="chaos-mode.js"></script>
</body>
</html>
